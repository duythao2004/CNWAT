<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <base href="/CNWAT/" />
    <title>Bài 3 – 2.10 Máy tính</title>
    <link rel="stylesheet" href="bt2/css/style.css" />
    <style>
      /* ======= Calculator ======= */
      .calc-wrap {
        max-width: 740px;
        margin: 0 auto;
      }
      .calc {
        width: 360px;
        background: #fff;
        border: 1px solid #d1d5db;
        border-radius: 10px;
        padding: 12px;
        box-shadow: 0 1px 0 #f3f4f6 inset;
      }
      .display {
        height: 44px;
        padding: 6px 10px;
        border: 1px solid #cbd5e1;
        border-radius: 6px;
        background: #f8fafc;
        font-size: 20px;
        text-align: right;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
      }
      .keys {
        margin-top: 10px;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
      }
      .btn {
        padding: 10px 0;
        border: 1px solid #cbd5e1;
        border-radius: 6px;
        background: #ffffff;
        text-align: center;
        font-weight: 600;
        user-select: none;
        cursor: pointer;
        box-shadow: 0 1px 0 #f3f4f6 inset;
        transition: background 0.1s, border-color 0.1s;
      }
      .btn:hover {
        background: #e9f6ff;
      }
      .btn.op {
        background: #f1f5f9;
      }
      .btn.equal {
        background: #d45adf;
        color: #fff;
        border-color: #da2ac2;
      }
      .btn.wide {
        grid-column: span 2;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <!-- cột trái -->
      <section class="student">
        <div class="avatar"><img src="bt2/assets/img/me.jpg" alt="" /></div>
        <div>
          <h3>Thông tin sinh viên</h3>
          <p><strong>Họ và tên:</strong> Nguyễn Duy Thảo</p>
          <p><strong>MSSV:</strong> AT190351</p>
        </div>
      </section>

      <!-- banner -->
      <header class="banner banner--video">
        <video
          class="banner-video"
          autoplay
          muted
          loop
          playsinline
          poster="bt2/assets/img/banner-poster.jpg"
        >
          <source src="bt2/assets/video/banner.webm" type="video/webm" />
          <source src="bt2/assets/video/banner.mp4" type="video/mp4" />
        </video>
      </header>

      <!-- menu trái -->
      <nav class="menu" aria-label="Menu">
        <h4>Menu</h4>
        <ul>
          <li><a href="bt2/index.html">Trang chủ</a></li>
          <li>
            <a href="bt2/gioi-thieu-ban-than.html">1.1 Giới thiệu bản thân</a>
          </li>
          <li><a href="bt2/bang-diem.html">1.2 Bảng điểm</a></li>
          <li><a href="bt2/ly-lich.html">1.3 Lý lịch</a></li>
          <li><a href="bt2/tin-tuc.html">1.4 Tin tức</a></li>
          <li><a href="bt3/vidu.html">2.1 Ví dụ JS</a></li>
          <li><a href="bt3/trac-nghiem.html">2.2 Thi trắc nghiệm</a></li>
          <li><a href="bt3/nhap-lop.html">2.3 Nhập LOP</a></li>
          <li><a href="bt3/nhap-hoso.html">2.4 Hồ sơ</a></li>
          <li><a href="bt3/form-dang-ky.html">2.5 Form đăng ký</a></li>
          <li><a href="bt3/danh-sach.html">2.6 Danh sách</a></li>
          <li><a href="bt3/thuc-don.html">2.7 Thực đơn</a></li>
          <li><a href="bt3/tab.html">2.8 Tab</a></li>
          <li><a href="bt3/cay.html">2.9 Cây</a></li>
          <li><a class="active" href="bt3/may-tinh.html">2.10 Máy tính</a></li>
          <li><a href="bt3/hoat-anh.html">2.11 Hoạt ảnh</a></li>
          <li><a href="bt3/sap-xep.html">2.12 Sắp xếp</a></li>
          <li><a href="bt4/index.php">3. Bài 4 (PHP & DB)</a></li>
        </ul>
      </nav>

      <!-- MAIN -->
      <main class="main card calc-wrap">
        <h1>2.10 Máy tính điện tử</h1>

        <div class="calc" id="calc">
          <div id="display" class="display" aria-live="polite">0</div>

          <div class="keys" id="keys">
            <!-- hàng phím chức năng -->
            <div class="btn op" data-action="clear-all">C</div>
            <div class="btn op" data-action="clear-entry">CE</div>
            <div class="btn op" data-action="sign">+/-</div>
            <div class="btn op" data-action="percent">%</div>

            <!-- số + phép toán -->
            <div class="btn" data-number="7">7</div>
            <div class="btn" data-number="8">8</div>
            <div class="btn" data-number="9">9</div>
            <div class="btn op" data-op="/">÷</div>

            <div class="btn" data-number="4">4</div>
            <div class="btn" data-number="5">5</div>
            <div class="btn" data-number="6">6</div>
            <div class="btn op" data-op="*">×</div>

            <div class="btn" data-number="1">1</div>
            <div class="btn" data-number="2">2</div>
            <div class="btn" data-number="3">3</div>
            <div class="btn op" data-op="-">−</div>

            <div class="btn wide" data-number="0">0</div>
            <div class="btn" data-action="decimal">.</div>
            <div class="btn op" data-op="+">+</div>

            <div class="btn equal wide" data-action="equals">=</div>
          </div>
        </div>
        <p class="muted" style="margin-top: 10px">
          Hỗ trợ: +, −, ×, ÷, %, +/−, C (xoá tất cả), CE (xoá số đang nhập), dấu
          thập phân và phím =.
        </p>
      </main>

      <footer class="footer">Thông tin bản quyền – © 2025</footer>
    </div>

    <script>
      /* ============== Calculator Logic ============== */
      const display = document.getElementById("display");
      const keys = document.getElementById("keys");

      const state = {
        displayValue: "0",
        firstOperand: null,
        operator: null,
        waitingForSecond: false,
      };

      function updateDisplay() {
        display.textContent = state.displayValue;
      }

      function inputDigit(d) {
        if (state.waitingForSecond) {
          state.displayValue = d;
          state.waitingForSecond = false;
        } else {
          state.displayValue =
            state.displayValue === "0" ? d : state.displayValue + d;
        }
      }

      function inputDecimal() {
        if (state.waitingForSecond) {
          state.displayValue = "0.";
          state.waitingForSecond = false;
          return;
        }
        if (!state.displayValue.includes(".")) {
          state.displayValue += ".";
        }
      }

      function handleOperator(nextOp) {
        const input = parseFloat(state.displayValue);
        if (state.operator && state.waitingForSecond) {
          state.operator = nextOp; // đổi phép khi đang chờ số 2
          return;
        }
        if (state.firstOperand == null) {
          state.firstOperand = input;
        } else if (state.operator) {
          const result = compute(state.firstOperand, input, state.operator);
          state.displayValue = String(result);
          state.firstOperand = result;
        }
        state.waitingForSecond = true;
        state.operator = nextOp;
      }

      function compute(a, b, op) {
        if (op === "+") return a + b;
        if (op === "-") return a - b;
        if (op === "*") return a * b;
        if (op === "/") return b === 0 ? NaN : a / b;
        return b;
      }

      function clearAll() {
        state.displayValue = "0";
        state.firstOperand = null;
        state.operator = null;
        state.waitingForSecond = false;
      }

      function clearEntry() {
        state.displayValue = "0";
      }

      function toggleSign() {
        if (state.displayValue === "0") return;
        state.displayValue = String(parseFloat(state.displayValue) * -1);
      }

      function percent() {
        state.displayValue = String(parseFloat(state.displayValue) / 100);
      }

      keys.addEventListener("click", (e) => {
        const t = e.target.closest(".btn");
        if (!t) return;

        if (t.dataset.number) {
          inputDigit(t.dataset.number);
          updateDisplay();
          return;
        }
        if (t.dataset.action === "decimal") {
          inputDecimal();
          updateDisplay();
          return;
        }
        if (t.dataset.action === "clear-all") {
          clearAll();
          updateDisplay();
          return;
        }
        if (t.dataset.action === "clear-entry") {
          clearEntry();
          updateDisplay();
          return;
        }
        if (t.dataset.action === "sign") {
          toggleSign();
          updateDisplay();
          return;
        }
        if (t.dataset.action === "percent") {
          percent();
          updateDisplay();
          return;
        }
        if (t.dataset.action === "equals") {
          if (state.operator) {
            handleOperator(state.operator); // tính nốt
            state.operator = null;
            state.firstOperand = null;
            state.waitingForSecond = false;
            updateDisplay();
          }
          return;
        }
        if (t.dataset.op) {
          handleOperator(t.dataset.op);
          updateDisplay();
        }
      });

      /* (Tùy chọn) hỗ trợ bàn phím số */
      window.addEventListener("keydown", (e) => {
        const { key } = e;
        if (/[0-9]/.test(key)) {
          inputDigit(key);
          updateDisplay();
        } else if (key === "." || key === ",") {
          inputDecimal();
          updateDisplay();
        } else if (["+", "-", "*", "/"].includes(key)) {
          handleOperator(key);
          updateDisplay();
        } else if (key === "Enter" || key === "=") {
          if (state.operator) {
            handleOperator(state.operator);
            state.operator = null;
            state.firstOperand = null;
            state.waitingForSecond = false;
            updateDisplay();
          }
        } else if (key.toLowerCase() === "c") {
          clearAll();
          updateDisplay();
        }
      });
    </script>
  </body>
</html>
